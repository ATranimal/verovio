
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <title>Dynamic demo</title>

<script src="../build/verovio-class.js" type="text/javascript"></script>	

<script type="text/javascript">

vrvToolkit = new verovio.toolkit();

function render_music( music, format )
{	
	// The trailing newline is needed so we can read the file lines
	// correctly if the file does not end with a newline
	//var svg = convertMusic(format, 0, music + "\n");
	
	var svg = vrvToolkit.renderData(music, JSON.stringify({inputFormat: format, scale: 50, pageWidth: 2100, border: 0, adjustPageHeight: true}));
	document.getElementById('test').innerHTML = svg;

};

function upload_file(input, format) {
	
	var file = document.getElementById(input).files[0];
	
	var reader = new FileReader();

	// Closure to capture the file information.
	reader.onload = (function(theFile) {
		return function(e) {
		// Render thumbnail.
		 //render_music(e.target.result, format);
		 //return;
		 vrvToolkit.setOptions(JSON.stringify({inputFormat: format, scale: 50, pageWidth: 2100, border: 0}));
		 vrvToolkit.loadData(e.target.result);
		 document.getElementById("total").innerHTML = "1/" + vrvToolkit.getPageCount();
		 svg = vrvToolkit.renderPage(1, "");
		 //svg = vrvToolkit.renderData(e.target.result, JSON.stringify({inputFormat: format, scale: 50, pageWidth: 2100, border: 0, adjustPageHeight: true}));
		 document.getElementById('test').innerHTML = svg;
	};
	})(file);

	// Read in the image file as a data URL.
	reader.readAsText(file);

  };

  var page = 1;
  
function next_page() {
	if (page >= vrvToolkit.getPageCount()) {
		return;
	}
	
	page = page + 1;

	document.getElementById("total").innerHTML = page + "/" + vrvToolkit.getPageCount();
	svg = vrvToolkit.renderPage(page, "");
	document.getElementById('test').innerHTML = svg;
} ;

function prev_page() {
	if (page <= 1) {
		return;
	}
	
	page = page - 1;
	document.getElementById("total").innerHTML = page + "/" + vrvToolkit.getPageCount();
	svg = vrvToolkit.renderPage(page, "");
	document.getElementById('test').innerHTML = svg;
} ;
  
</script>
</head>
<body>
<h3>Read PAE/MEI from Javascript Demo</h3>
<button onclick="prev_page()"><<</button>
<label id="total">0</label>
  <button onclick="next_page()">>></button>
  
	<div id="test">	(output will be here)</div>

	<hr>
	Please enter some pae:
  <form onsubmit="render_music(texty.value, 'pae'); return false">
	<textarea rows="10" cols="50" name="texty">
@start:00000400003643-1.1.1
@clef:C-1
@keysig:xFC
@key:
@timesig:3/4
@data: ''4D/{8D6CD}4EC/i/8{D'B}AG
@end:00000400003643-1.1.1
	</textarea>
    <input type="submit" value="Render">
  </form>
  <hr>
  Or select a PAE file to read:

  <form onsubmit="upload_file('pae_files', 'pae'); return false">
    <input type="file" id="pae_files" name="files[]" />
    <input type="submit" value="Render">
  </form>
  <hr>
  Alternatively read a MEI file:

  <form onsubmit="upload_file('mei_files', 'mei'); return false">
    <input type="file" id="mei_files" name="files[]" />
    <input type="submit" value="Render">
  </form>

</body>