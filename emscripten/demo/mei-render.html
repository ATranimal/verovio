
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <title>Render MEI File</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">

</head>
<body>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="https://code.jquery.com/jquery.js"></script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>

	<script src="../build/verovio-class.js" type="text/javascript"></script>	

<script type="text/javascript">

	var vrvToolkit = new verovio.toolkit();
	var page = 1;
	var zoom = 40;

	function upload_file(input, format) {
	
		var file = document.getElementById(input).files[0];
	
		var reader = new FileReader();

		// Closure to capture the file information.
		reader.onload = (function(theFile) {
			return function(e) {
				vrvToolkit.setOptions(JSON.stringify({inputFormat: format, scale: 100, pageWidth: 2100, border: 0}));
				vrvToolkit.loadData(e.target.result);
				
				document.getElementById("total_text").innerHTML = vrvToolkit.getPageCount();
				
				//zoom = 40;
				page = 1;
				set_zoom(zoom);
				// set_zoom calls goto page
				//goto_page(page);
			};
		})(file);

		// Read in the image file as a data URL.
		reader.readAsText(file);

	};


	function goto_page(page_nr) {
		document.getElementById('jump_text').value = page_nr;
	
		svg = vrvToolkit.renderPage(page_nr, "");
		document.getElementById('svg_output').innerHTML = svg;
	};

	function next_page() {
		if (page >= vrvToolkit.getPageCount()) {
			return;
		}
	
		page = page + 1;
		goto_page(page);
	};

	function prev_page() {
		if (page <= 1) {
			return;
		}
	
		page = page - 1;
		goto_page(page);
	};
  
  	function set_zoom(zoom_nr) {
  		vrvToolkit.setOptions(JSON.stringify({scale: zoom_nr}));
		goto_page(page);
		
		document.getElementById('zoom_text').value = zoom_nr + "%";
  	}
  
  	function zoom_out() {
  		if (zoom <= 10) {
  			return;
  		}
		
		zoom = zoom - 10;
		set_zoom(zoom);
  	}
	
  	function zoom_in() {
  		if (zoom > 150) {
  			return;
  		}
		
		zoom = zoom + 10;
		set_zoom(zoom);
  	}
  
	function do_page_enter(e) {
		key = e.keyCode || e.which;
		if (key == 13) {
			
			text = document.getElementById('jump_text').value;
			
			if (text <= vrvToolkit.getPageCount() && text > 0) {
				page = Number(text);
				goto_page(page);
			} else {
				 document.getElementById('jump_text').value = page;
			}
			
		}
	}
	
	function do_zoom_enter(e) {
		key = e.keyCode || e.which;
		if (key == 13) {
			
			text = document.getElementById('zoom_text').value;
			
			if (text < 150 && text > 10) {
				zoom = Number(text);
				set_zoom(zoom);
			}
			
		}
	}
  
</script>
	
    <div class="container">
      <div class="header">
        <ul class="nav nav-pills pull-right">
          <li><a href="#">Home</a></li>
		  <li class="active"><a href="#">MEI Rendering</a></li>
          <li><a href="#">About</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
        <h3 class="text-muted">Verovio</h3>
      </div>
	  
	  <hr>
	  
      <div class="row row-offcanvas row-offcanvas-right">

          <div class="col-xs-9">
              <p class="pull-right visible-xs">
                  <button type="button" class="btn btn-primary btn-xs" data-toggle="offcanvas">Toggle nav</button>
              </p>
	  	  
			  <div class="panel panel-default">
				<div class="panel-heading">Select MEI File</div>
			    <div class="panel-body">
				  <form onsubmit="upload_file('mei_files', 'mei'); return false" class="form-inline" role="form">
					  <div class="form-group">
				    	  <input type="file" id="mei_files" name="files[]" />
					  </div>
				    <button type="submit" class="btn btn-default">Render</button>
				  </form>
		  		</div>
			</div>
			
			
		  <div class="panel panel-default">
		    <div class="panel-body">
				<div id="svg_output" style="overflow:auto; height:800px">
					
				</div>
			</div>
		</div>
			
		</div>
		
		<div class="col-xs-3 sidebar-offcanvas" id="sidebar" role="navigation">
		  <div class="panel panel-default">
			<div class="panel-heading">Navigation</div>
		    <div class="panel-body">
				
					<div class="row">
					  <div class="col-lg-6">
						<p>Go to Page:</p>
					    <div class="input-group input-group-sm">
					      	<span class="input-group-btn">
					        	<button onclick="prev_page()" class="btn btn-default" type="button"><<</button>
					      	</span>
					      	<input type="text" class="form-control" placeholder="0" id="jump_text" style="width:40px" onkeypress="do_page_enter(event)">
						  	<span class="input-group-addon" id="total_text">/ 0</span>
					      	<span class="input-group-btn">
					        	<button onclick="next_page()" class="btn btn-default" type="button">>></button>
					      	</span>
					    </div><!-- /input-group -->
					  </div><!-- /.col-lg-6 -->
					</div><!-- /.row -->
					
					<hr>
					
					<div class="row">
					  <div class="col-lg-6">
						<p>Zoom:</p>
					    <div class="input-group input-group-sm">
					      	<span class="input-group-btn">
					        	<button onclick="zoom_out()" class="btn btn-default" type="button"><span class="glyphicon glyphicon-zoom-out"></span></button>
					      	</span>
					      	<input type="text" class="form-control" placeholder="100%" id="zoom_text" style="width:60px" onkeypress="do_zoom_enter(event)">
					      	<span class="input-group-btn">
					        	<button onclick="zoom_in()" class="btn btn-default" type="button"><span class="glyphicon glyphicon-zoom-in"></span></button>
					      	</span>
					    </div><!-- /input-group -->
					  </div><!-- /.col-lg-6 -->
					</div><!-- /.row -->
					
				</div>
			</div>
			
		</div>		
	</div>
	
</div>
</div>
</body>